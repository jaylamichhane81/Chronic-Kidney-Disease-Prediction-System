# -*- coding: utf-8 -*-
"""Chronic-Kidney-Disease-Prediction-System.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1claZB5wEP589RSXPId5IzbB5hlrnp3Z9
"""

import pandas as pd
import numpy as np

#preprocessing tools
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler,MinMaxScaler

#Classification Models
from sklearn.linear_model import LogisticRegression
from sklearn.svm import SVC
from sklearn.ensemble import RandomForestClassifier
from sklearn.neighbors import KNeighborsClassifier
from sklearn.tree import DecisionTreeClassifier
from sklearn.naive_bayes import GaussianNB
from sklearn.ensemble import AdaBoostClassifier
from sklearn.ensemble import GradientBoostingClassifier

#for model evaluation
from sklearn.metrics import classification_report,confusion_matrix,accuracy_score

!pip install streamlit

import streamlit as st

#Load Dataset
@st.cache_data
def load_data():
  df=pd.read_csv('/content/kidney_disease.csv')

df=pd.read_csv('/content/kidney_disease.csv')
df.head(2)

"""Short definitions for each important feature
'age': 'Patient age (years)',

'bp': 'Blood pressure (mm/Hg)',

'sg': 'Urine specific gravity',

'al': 'Albumin in urine (0‚Äì5)',

'hemo': 'Hemoglobin level (g/dL)',

'sc': 'Serum creatinine (mg/dL)',

'htn': 'Hypertension (yes/no)',

'dm': 'Diabetes mellitus (yes/no)',

'cad': 'Coronary artery disease (yes/no)',

'appet': 'Appetite status (good/poor)',

'pc': 'Pus cell status (normal/abnormal)',

'classification': 'CKD diagnosis (ckd/notckd)'
"""

important_columns = ['age', 'bp', 'sg', 'al', 'hemo', 'sc','htn','dm','cad','appet','pc','classification']
df = df[important_columns]
df

df['cad'].value_counts()

# Clean the dataset
for col in df.select_dtypes(include='object').columns:
    df[col] = df[col].str.strip().str.replace('\t', '', regex=True)

print(df['cad'].value_counts())
print(df['dm'].value_counts())
print(df['classification'].value_counts())

#Check missing values
df.isnull().sum()

# Fill missing values with appropriate methods
df['age'].fillna(df['age'].median(), inplace=True)         # Numerical ‚Üí median
df['bp'].fillna(df['bp'].median(), inplace=True)           # Numerical ‚Üí median
df['sg'].fillna(df['sg'].mode()[0], inplace=True)          # Categorical (discrete numeric) ‚Üí mode
df['al'].fillna(df['al'].mode()[0], inplace=True)          # Categorical (discrete numeric) ‚Üí mode
df['hemo'].fillna(df['hemo'].median(), inplace=True)       # Numerical ‚Üí median
df['sc'].fillna(df['sc'].median(), inplace=True)           # Numerical ‚Üí median
df['htn'].fillna(df['htn'].mode()[0], inplace=True)        # Categorical (yes/no) ‚Üí mode
df['dm'].fillna(df['dm'].mode()[0], inplace=True)          # Categorical (yes/no) ‚Üí mode
df['cad'].fillna(df['cad'].mode()[0], inplace=True)        # Categorical (yes/no) ‚Üí mode
df['appet'].fillna(df['appet'].mode()[0], inplace=True)    # Categorical ‚Üí mode
df['pc'].fillna(df['pc'].mode()[0], inplace=True)          # Categorical ‚Üí mode

df.isnull().sum()

#Encoding
df['htn']=df['htn'].map({'yes':1,'no':0})
df['dm']=df['dm'].map({'yes':1,'no':0})
df['cad']=df['cad'].map({'yes':1,'no':0})
df['appet']=df['appet'].map({'good':1,'poor':0})
df['pc']=df['pc'].map({'normal':1,'abnormal':0})
df['classification']=df['classification'].map({'ckd':1,'notckd':0})

df.head(2)

#Scaling: Normalization
numeric_columns=['age','bp','sg','al','hemo','sc']

scaler=MinMaxScaler()

df[numeric_columns]=scaler.fit_transform(df[numeric_columns])
df.head(2)

df['classification'].value_counts()

X=df.drop('classification',axis=1)
y=df['classification']

# import train test split
X_train, X_test, y_train, y_test = train_test_split(X, y,test_size=0.2,random_state=42)

#Traning,Testing Multiple Classifiers
models = {
    "Logistic Regression": LogisticRegression(),
    "Support Vector Classifier": SVC(),
    "Random Forest Classifier": RandomForestClassifier(),
    "K Nearest Neighbors": KNeighborsClassifier(),
    "Decision Tree Classifier": DecisionTreeClassifier(),
    "Gaussian Naive Bayes": GaussianNB(),
    "AdaBoost Classifier": AdaBoostClassifier(),
    "Gradient Boosting Classifier": GradientBoostingClassifier()
}


# Train and evaluate each model
for name, model in models.items():
    print("="*50)
    print("Model:", name)
    # Train the model
    model.fit(X_train, y_train)

    # Predict on test set
    y_pred = model.predict(X_test)

    # Calculate metrics
    accuracy = accuracy_score(y_test, y_pred)
    classification_rep = classification_report(y_test, y_pred)
    conf_matrix = confusion_matrix(y_test, y_pred)

    # Print metrics
    print("Accuracy:", accuracy)
    print("Classification Report:\n", classification_rep)
    print("Confusion Matrix:\n", conf_matrix)

model_gbc = AdaBoostClassifier()

model_gbc.fit(X_train,y_train)

y_pred = model_gbc.predict(X_test)



print("confusion matrix \n: ", confusion_matrix(y_test,y_pred))
print("classification report \n: ", classification_report(y_test, y_pred))

st.subheader("üìä Model Performance")
st.write("Accuracy:", accuracy_score(y_test, y_pred))

# ------ Sidebar User Input ------
st.sidebar.header("Enter Patient Details")

def get_user_input():
    age = st.sidebar.slider("Age", 1, 90, 45)
    bp = st.sidebar.slider("Blood Pressure", 50, 180, 80)
    sg = st.sidebar.selectbox("Specific Gravity", [1.005, 1.010, 1.015, 1.020, 1.025])
    al = st.sidebar.slider("Albumin", 0, 5, 1)
    hemo = st.sidebar.slider("Hemoglobin", 3.0, 17.0, 12.0)
    sc = st.sidebar.slider("Serum Creatinine", 0.1, 15.0, 1.2)

    htn = st.sidebar.selectbox("Hypertension", ['yes', 'no'])
    dm = st.sidebar.selectbox("Diabetes Mellitus", ['yes', 'no'])
    cad = st.sidebar.selectbox("Coronary Artery Disease", ['yes', 'no'])
    appet = st.sidebar.selectbox("Appetite", ['good', 'poor'])
    pc = st.sidebar.selectbox("Pus Cell", ['normal', 'abnormal'])

    data = {
        "age": age,
        "bp": bp,
        "sg": sg,
        "al": al,
        "hemo": hemo,
        "sc": sc,
        "htn": 1 if htn == 'yes' else 0,
        "dm": 1 if dm == 'yes' else 0,
        "cad": 1 if cad == 'yes' else 0,
        "appet": 1 if appet == 'good' else 0,
        "pc": 1 if pc == 'normal' else 0
    }

    return pd.DataFrame([data])

user_df = get_user_input()

# ----- Prediction -----
if st.sidebar.button("üîç Predict"):
    prediction = model.predict(user_df)[0]

    st.subheader("ü©∫ Prediction Result")
    if prediction == 1:
        st.error("‚ö†Ô∏è Patient is likely to have **Chronic Kidney Disease (CKD)**.")
    else:
        st.success("‚úÖ Patient does **NOT** have CKD.")

st.write("---")
st.write("Developed by **Jay Lamichhane**")

